name: Build Windows
on: [workflow_dispatch]
jobs:
  build-windows:
    runs-on: windows-2022
    steps:
      # https://github.com/actions/checkout
      - name: checkout source
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
      # https://stackoverflow.com/questions/5879076/how-to-create-a-batch-file-for-visual-studio-command-prompt
      - name: build
        run: |
          call "C:/Program Files/Microsoft Visual Studio/2022/Enterprise/VC/Auxiliary/Build/vcvarsall.bat" x86_amd64
          cmake --preset windows-x64-debug
          cmake --build --preset windows-x64-debug
          cpack -G WIX --config out/build/windows-x64-debug/CPackConfig.cmake
          mkdir Windows
          copy ChristiansSteamBot*.msi Windows
        shell: cmd
      # https://github.com/actions/upload-artifact
      - name: upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows
          path: Windows
          overwrite: true
